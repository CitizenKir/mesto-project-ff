(()=>{"use strict";var e={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-27",headers:{authorization:"b5346afd-b691-4cb1-b750-bf9b11d6179b","Content-Type":"application/json"}},t=function(t){var n,r=t.target.closest(".places__item");return n=r.id,fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),r.remove()},n=function(t){var n,r=t.target.closest(".places__item"),o=t.target,c=r.querySelector(".card__like-count"),a=Number(c.textContent);return o.classList.contains("card__like-button_is-active")?(n=r.id,fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),c.textContent=a-1):(function(t){fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(r.id),c.textContent=a+1),t.target.classList.toggle("card__like-button_is-active")},r={close:c,overlayClickHandler:null,keyHandler:null},o=function(e,t,n,o){t.addEventListener("click",(function(){c(e)})),e.addEventListener("mousedown",n),document.addEventListener("keydown",o),r.overlayClickHandler=n,r.keyHandler=o,e.classList.add("popup_is-opened")},c=function(e){document.removeEventListener("keydown",r.keyHandler),e.removeEventListener("click",r.close),e.removeEventListener("mousedown",r.overlayClickHandler),e.classList.remove("popup_is-opened")},a=function(e){if(e.target.classList.contains("popup")){var t=document.querySelector(".popup_is-opened");c(t)}},i=function(e){if("Escape"===e.code){var t=document.querySelector(".popup_is-opened");c(t)}},u=function(e,t){t?e.textContent="Сохранение...":!1===t&&(e.textContent="Сохранить")},s=function(e,t,n,r){e.classList.remove(t),n.classList.remove(r),n.textContent=""},l=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.disabled=!1,e.classList.remove(t)}(t,n):function(e,t){e.disabled=!0,e.classList.add(t)}(t,n)},d=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);l(n,r,t.inactiveButtonClass),n.forEach((function(n){var r=e.querySelector(".".concat(n.id,"-error"));s(n,t.inputErrorClass,r,t.errorClass)}))},p=document.querySelector("#card-template").content,f=document.querySelector(".places__list"),m=document.querySelector(".profile__edit-button"),_=document.getElementById("profile_edit"),v=_.querySelector(".popup__close"),y=document.querySelector(".profile__add-button"),h=document.getElementById("profile_add"),S=h.querySelector(".popup__close"),b=document.getElementById("image_detail"),k=b.querySelector(".popup__close"),q=b.querySelector(".popup__image"),E=b.querySelector(".popup__caption"),C=document.forms.profileEdit,L=document.forms.newPlace,g=document.forms.avatarEdit,j=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),P=document.querySelector(".profile__image"),B=document.getElementById("avatar_edit"),U=B.querySelector(".popup__close"),A=C.name,H=C.description,w=null;Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){var t=e[0],n=e[1];w=t._id,n.map((function(e){return F(e,w)})),V(t)}));var T,I,N,D,O,J,M,V=function(e){j.textContent=e.name,x.textContent=e.about,P.style.backgroundImage="url(".concat(e.avatar,")")},z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__input_error-text_active"},F=function(e,r){var o=function(e,t,n,r,o,c){var a,i,u=e.cloneNode(!0),s=u.querySelector(".card__delete-button"),l=u.querySelector(".card__image"),d=u.querySelector(".card__title"),p=u.querySelector(".card__like-button"),f=u.querySelector(".card__like-count"),m=u.querySelector("li");return a=c,i=t.owner._id,a===i||function(e){e.remove()}(s),t.likes.some((function(e){return e._id===c}))&&p.classList.add("card__like-button_is-active"),l.src=t.link,l.alt=t.name,d.textContent=t.name,f.textContent=t.likes.length,m.id=t._id,p.addEventListener("click",r),s.addEventListener("click",n),l.addEventListener("click",o),u}(p,e,t,n,G,r);f.prepend(o)},G=function(e){q.src=e.target.currentSrc,q.alt=e.target.alt,E.textContent=e.target.alt,o(b,k,a,i)};m.addEventListener("click",(function(){A.value=j.textContent,H.value=x.textContent,o(_,v,a,i),d(_.querySelector(z.formSelector),z)})),y.addEventListener("click",(function(){o(h,S,a,i),d(h.querySelector(z.formSelector),z)})),P.addEventListener("click",(function(){o(B,U,a,i),d(B.querySelector(z.formSelector),z)})),C.addEventListener("submit",(function(t){t.preventDefault();var n,r,o=_.querySelector(".popup__button");u(o,!0),(n=A.value,r=H.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){j.textContent=e.name,x.textContent=e.about})).finally((function(e){u(o,!1)})),c(_)})),L.addEventListener("submit",(function(t){t.preventDefault();var n,r,o=L.placeName.value,a=L.link.value,i=h.querySelector(".popup__button");u(i,!0),(n=o,r=a,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){F(e,w)})).finally((function(e){u(i,!1)})),L.reset(),c(h)})),g.addEventListener("submit",(function(t){t.preventDefault();var n,r=g.avatar.value,o=g.querySelector(".popup__button");u(o,!0),(n=r,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){P.style.backgroundImage="url(".concat(e.avatar,")")})).finally((function(e){u(o,!1)})),g.reset(),c(B)})),I=(T=z).formSelector,N=T.inputSelector,D=T.submitButtonSelector,O=T.inactiveButtonClass,J=T.inputErrorClass,M=T.errorClass,Array.from(document.querySelectorAll(I)).forEach((function(e){!function(e,t,n,r,o,c){var a=e.querySelector(n),i=Array.from(e.querySelectorAll(t));l(i,a,r),i.forEach((function(t){t.addEventListener("input",(function(){var n=e.querySelector(".".concat(t.id,"-error"));!function(e,t,n,r,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?s(e,t,r,o):function(e,t,n,r,o){e.classList.add(t),n.classList.add(r),n.textContent=o}(e,t,r,o,e.validationMessage)}(t,o,0,n,c),l(i,a,r)}))}))}(e,N,D,O,J,M)}))})();